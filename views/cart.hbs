{{!-- newcart --}}



<section class="h-100 h-custom mt-5 p-3" style="background-color:">
  <div class="container h-100 py-5">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col">
        <div class="card shopping-cart" style="border-radius: 15px;">
          <div class="card-body text-black">

            <div class="row">
              <div class="col-lg-6 px-5 py-4">

                <h3 class="mb-5 pt-2 text-center fw-bold text-uppercase">Your Cart</h3>




                {{#each products}}

                <div class="d-flex align-items-center mb-5">
                  <div class="flex-shrink-0">
                    <img src="{{this.productDetails.image.[0]}}" class="img-fluid" style="width: 150px;"
                      alt="Generic placeholder image">
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <a href="#!" class="float-end text-black"><i class="fas fa-times"></i></a>
                    <h5 class="text-primary">{{this.productDetails.name}}</h5>
                    <h6 style="color: #9e9e9e;">Category:{{this.productDetails.category}} </h6>
                    <div class="d-flex align-items-center">
                      <p class="fw-bold mb-0 me-5 pe-3">{{this.productDetails.offerprice}}</p>

                      <div class="w-25 mt-3">
                        <button class="cart-item-count mr-3 btn btn-light"
                          onclick="changeQuantity('{{this._id}}','{{this.productDetails._id}}','{{../userId}}',-1)">-</button>
                        <span id="{{this.productDetails._id}}">{{this.quantity}}</span>
                        <button class="cart-item-count ml-3 btn btn-light "
                          onclick="changeQuantity('{{this._id}}','{{this.productDetails._id}}','{{../userId}}',1)">+</button>

                        <button onclick="removeItem('{{this.productDetails._id}}')"
                          class="btn btn-danger text-uppercase mr-2 px-4">Remove</button>
                      </div>
                    </div>
                  </div>
                </div>
                {{/each}}
                <hr class="mb-4" style="height: 2px; background-color: #1266f1; opacity: 1;">

                <div class="d-flex justify-content-between px-x">
                  <p class="fw-bold">Discount:</p>
                  <p class="fw-bold">0</p>
                </div>
                <div class="d-flex justify-content-between p-2 mb-2" style="background-color: #e1f5fe;">
                  <h5 class="fw-bold mb-0">Total:</h5>
                  <h5 class="fw-bold mb-0"><span id="total">{{totalAmount}}</span></h5>
                </div>

              </div>



              <div class="col-lg-6 px-5 py-4">
                <div class="card mb-4">
                  <div class="card-header py-3">
                    <h5 class="mb-0">Summary</h5>
                  </div>
                  <div class="card-body">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                        Products
                        <span id="totalAmount">{{totalAmount}}</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        Shipping
                        <span>0</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                        <div>
                          <strong>Total amount</strong>
                          <strong>
                            <p class="mb-0">(including VAT)</p>
                          </strong>
                        </div>
                        <span><strong><h3 id="totalPrice"  class="fw-bold" >{{totalAmount}}</h3></strong></span>
                      </li>
                    </ul>

                    

                    
                    {{#if products}}
                    <a href="/checkcart"> <button type="button" class="btn btn-primary btn-lg btn-block">
                        Go to checkout
                      </button></a>
                {{else}}
                 <a href="#"> <button type="button" class="btn btn-primary btn-lg btn-block">
                        Cart is empty Do explore
                      </button></a>
                 {{/if}}
                 
                  </div>
                </div>
              </div>




















              {{!-- <div class="col-lg-6 px-5 py-4">

                <h3 class="mb-5 pt-2 text-center fw-bold text-uppercase">Payment</h3>

                <form class="mb-5">

                  <div class="form-outline mb-3">
                    <input type="text" id="typeText" class="form-control form-control-lg" />
                    <label class="form-label" for="typeText">Name</label>
                  </div>

                  <div class="form-outline mb-3">
                    <input type="text" id="typeName" class="form-control form-control-lg" siez="17" />
                    <label class="form-label" for="typeName">Address</label>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-5">
                      <div class="form-outline">
                        <input type="text" id="pincode" class="form-control form-control-lg" />
                        <label class="form-label" for="pincode">Pincode</label>
                      </div>
                    </div>
                    <div class="col-md-6 mb-5">
                      <div class="form-outline">
                        <input type="text" id="phnonenumber" class="form-control form-control-lg" />
                        <label class="form-label" for="typeText">Phone number</label>
                      </div>
                    </div>
                  </div> --}}

                  {{!-- <div class="row">
                    <div class="col-md-3 col-lg-3 col-xl-3 mb-4 mb-md-0">
                      <form>
                        <div class="d-flex flex-row pb-3">
                          <div class="d-flex align-items-center pe-2">
                            <input class="form-check-input" type="radio" name="radioNoLabel" id="radioNoLabel1v"
                              value="" aria-label="..." checked />
                          </div>
                          <div class="rounded border w-20px p-3">
                            <p class="d-flex align-items-center mb-0">
                              <i class="fab fa-cc-mastercard fa-2x text-dark pe-2"></i>Credit
                              Card
                            </p>
                          </div>
                        </div>
                        <div class="d-flex flex-row pb-3">
                          <div class="d-flex align-items-center pe-2">
                            <input class="form-check-input" type="radio" name="radioNoLabel" id="radioNoLabel2v"
                              value="" aria-label="..." />
                          </div>
                          <div class="rounded border w-20px p-3">
                            <p class="d-flex align-items-center mb-0">
                              <i class="fab fa-cc-visa fa-2x fa-lg text-dark pe-2"></i>Debit Card
                            </p>
                          </div>
                        </div>
                        <div class="d-flex flex-row">
                          <div class="d-flex align-items-center pe-2">
                            <input class="form-check-input" type="radio" name="radioNoLabel" id="radioNoLabel3v"
                              value="" aria-label="..." />
                          </div>
                          <div class="rounded border w-20px p-3">
                            <p class="d-flex align-items-center mb-0">
                              <i class="fab fa-cc-paypal fa-2x fa-lg text-dark pe-2"></i>PayPal
                            </p>
                          </div>
                        </div>
                      </form>
                    </div> --}}










                    {{!-- <p class="mb-5">Lorem ipsum dolor sit amet consectetur, adipisicing elit <a
                        href="#!">obcaecati sapiente</a>.</p>

                    <button type="button" class="btn btn-primary btn-block btn-lg">Buy now</button> --}}

                    {{!-- <h5 class="fw-bold mb-5" style="position: absolute; bottom: 0;">
                      <a href="#"><i class="fas fa-angle-left me-2"></i>Back to shopping</a>
                    </h5> --}}

                </form>

              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>






</section>









<style>
  @media (min-width: 1025px) {
    .h-custom {
      height: 100vh !important;
    }
  }

  .number-input input[type="number"] {
    -webkit-appearance: textfield;
    -moz-appearance: textfield;
    appearance: textfield;
  }

  .number-input input[type=number]::-webkit-inner-spin-button,
  .number-input input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
  }

  .number-input button {
    -webkit-appearance: none;
    background-color: transparent;
    border: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    margin: 0;
    position: relative;
  }

  .number-input button:before,
  .number-input button:after {
    display: inline-block;
    position: absolute;
    content: '';
    height: 2px;
    transform: translate(-50%, -50%);
  }

  .number-input button.plus:after {
    transform: translate(-50%, -50%) rotate(90deg);
  }

  .number-input input[type=number] {
    text-align: center;
  }

  .number-input.number-input {
    border: 1px solid #ced4da;
    width: 10rem;
    border-radius: .25rem;
  }

  .number-input.number-input button {
    width: 2.6rem;
    height: .7rem;
  }

  .number-input.number-input button.minus {
    padding-left: 10px;
  }

  .number-input.number-input button:before,
  .number-input.number-input button:after {
    width: .7rem;
    background-color: #495057;
  }

  .number-input.number-input input[type=number] {
    max-width: 4rem;
    padding: .5rem;
    border: 1px solid #ced4da;
    border-width: 0 1px;
    font-size: 1rem;
    height: 2rem;
    color: #495057;
  }

  @media not all and (min-resolution:.001dpcm) {
    @supports (-webkit-appearance: none) and (stroke-color:transparent) {

      .number-input.def-number-input.safari_only button:before,
      .number-input.def-number-input.safari_only button:after {
        margin-top: -.3rem;
      }
    }
  }

  .shopping-cart .def-number-input.number-input {
    border: none;
  }

  .shopping-cart .def-number-input.number-input input[type=number] {
    max-width: 2rem;
    border: none;
  }

  .shopping-cart .def-number-input.number-input input[type=number].black-text,
  .shopping-cart .def-number-input.number-input input.btn.btn-link[type=number],
  .shopping-cart .def-number-input.number-input input.md-toast-close-button[type=number]:hover,
  .shopping-cart .def-number-input.number-input input.md-toast-close-button[type=number]:focus {
    color: #212529 !important;
  }

  .shopping-cart .def-number-input.number-input button {
    width: 1rem;
  }

  .shopping-cart .def-number-input.number-input button:before,
  .shopping-cart .def-number-input.number-input button:after {
    width: .5rem;
  }

  .shopping-cart .def-number-input.number-input button.minus:before,
  .shopping-cart .def-number-input.number-input button.minus:after {
    background-color: #9e9e9e;
  }

  .shopping-cart .def-number-input.number-input button.plus:before,
  .shopping-cart .def-number-input.number-input button.plus:after {
    background-color: #4285f4;
  }
</style>











<script>

function changeQuantity(cartId, productId, userId, count) {
    //taking the value of quantity by id
    let quantity = parseInt(document.getElementById(productId).innerHTML)
      console.log(userId,'ghhhjjkkk')

    $.ajax({

      url: '/change-product-quantity',
      data: {
        user:userId,
        cart: cartId,
        product: productId,
        count: count,
        quantity: quantity

      },
      method: 'post',
      success: (response) => {
        if (response.removeProduct) {
          swal('product removed')
         
          setTimeout(()=>{
         window.location.reload()
          },1000)
          
         
       
       
       
        } else if(response.stockOut){

          swal('stock out')
        }
        else {
          document.getElementById(productId).innerHTML = quantity + count
          document.getElementById('total').innerHTML = response.totalAmount

           document.getElementById('totalAmount').innerHTML = response.totalAmount
           document.getElementById('totalPrice').innerHTML = response.totalAmount
        }



      }
    })
  }

  function removeItem(productId) {
    console.log(productId, "productId is this")

    swal({
      title: "Are you sure?",
      text: "Do you want to remove this from cart?",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    })
      .then((willDelete) => {
        if (willDelete) {
          $.ajax({
            url: '/remove-cart-item/' + productId,
            type: 'get',
            success: (response) => {
              location.reload();
            }

          })
        }
      });
  }



</script>