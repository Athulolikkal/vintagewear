<div class="container pt-5 mt-5">

  <div class="row p-5 mt-5" style="box-shadow: 0 0 10px rgb(175, 154, 127);background-color:white;">
    <div class="col-md-4 order-md-2 mb-4 p-5 mt-5" style="box-shadow: 0 0 5px rgb(131, 123, 112);">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Your cart</span>
        {{!-- <span class="badge badge-secondary badge-pill">3</span> --}}
      </h4>
      <ul class="list-group mb-3">
        <li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">Product</h6>
            <small class="text-muted">total amount is</small><br>
            <small class=" text-success fw-bold" id="couponadded" style="display: none;">couponadded</small>
          </div>
          <span class="text-muted">{{totalAmount}}</span>
        </li>
        
       
        <li class="list-group-item d-flex justify-content-between lh-condensed"   >
          <div >
            {{!-- <h6 class="my-0">Product</h6> --}}
            <small class="text-muted" id="discounttext" style="display: none;">coupon discount is</small><br>
            {{!-- <small class=" text-success fw-bold" id="couponadded" style="display: none;">couponadded</small> --}}
          </div>
          <span class="text-muted" id="discountrate" style="display: none;">0</span>
        </li>
       
       
       
       
        {{!-- <p class="text-danger" id="couponadded">coupon activated</p> --}}
        <li class="list-group-item d-flex justify-content-between lh-condensed">
         
          <div>
           

        <li class="list-group-item d-flex justify-content-between" id="totalprice">
          <span >Total </span>
         
          
          <strong>{{totalAmount}}</strong>
       
        </li>
      </ul>

    
    
    <div>
     

  <button type="button" id="applycoupon" class="btn-applycoupon" data-bs-toggle="modal" data-bs-target="#couponModal">
   apply coupon
</button>

 <a href="/cancelcoupon"><button type="button"   id="cancelcoupon" class="btn btn-warning" style="display:none;"  >
 cancel coupon
</button></a>
   
   
    </div>



   
{{!-- modal-coupon-starts --}}

<div class="modal fade" id="couponModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header ">
        <h5 class="modal-title ml-5 text-center fw-bold" id="exampleModalLabel">Coupon Apply</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        
      </div>
      <div><p class="text-center text-danger fw-bold" id="errcoupon" style="display: none;">unvalid coupon code</p></div>
      
      <form action="/applyCoupon-offer" id="applyCoupon" method="post">
      
        {{!-- <p class="text-center text-success fw-bold" id="successcoupon">coun redeemed successfully</p> --}}
        
        
         <div class="modal-body">
        <label class="fw-bold" >enter the coupon code :</label>
        <input type="text" for="coupon" name="couponCode">
        
     
      </div>

     
     
      <div class="modal-footer" style="background:linear-gradient(135deg, #65799b 0%,#f9c900 100%);">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Apply</button>
      </div>
     </form>
    </div>
  </div>
</div>
   
{{!-- coupon modal ends --}}
    </div>


    <div class="col-md-8 order-md-1">
      <h4 class="mb-3 text-center fw-bold">Billing address</h4>
      <form class="needs-validation" action="" id="checkout-form">
        <div class="row">
          
         
        </div>

       
    
        {{!-- totalamount --}}
        <input type="text" class="form-control" style="display: none;" id="actualCost" name="totalprice" value={{totalAmount}}>

        
      
      {{!-- multiple address --}}
      <div>
    
   
   <!-- Button trigger modal -->
<dv class='mb-4'>
<button type="button" class="btn-applycoupon mb-3 ml-5" data-bs-toggle="modal" data-bs-target="#multipleAddress">
  Add Order Address
</button>
</dv>

    
    <div class="mt-2 ">

     {{#each orderAddress}}
      <div class="form-check">
   
 <div class="card fw-bold mb-3 pb-3" style="box-shadow: 0 0 5px rgb(109, 109, 109);">
   <input class="form-check-input" type="radio" name="orderAddressId" id="orderAddressId" value={{this.orderAddressId}} checked>
    <label class="form-check-label" for="flexRadioDefault1">
   {{this.housename}} house,&nbsp; {{this.street}},&nbsp; {{this.town}},<br> {{this.district}},Pin:&nbsp; {{this.pincode}}
    </label>
    </div>
   
   </div>
   {{/each}}
    
    </div>
    
    
   
   
  
   


      </div>
      
        <input type="text" name="userId" id="" value="{{user._id}}" hidden>


        {{!-- <hr class="mb-4"> --}}



        <h4 class="mb-3">Payment</h4>

        <div class="d-block my-3 ">

          <div class="custom-control custom-radio">
            <input id="credit" name="payment-method" value="COD" type="radio" class="custom-control-input" checked
              required>
            <label class="custom-control-label" for="cod">COD</label>
          </div>

         
         
          <div class="custom-control custom-radio">
            <input id="paypal" name="payment-method" value="paypal" type="radio" class="custom-control-input" required>
            <label class="custom-control-label" for="paypal">PayPal</label>
          </div>
       
         <div class="custom-control custom-radio">
            <input id="stripe" name="payment-method" value="stripe" type="radio" class="custom-control-input" required>
            <label class="custom-control-label" for="stripe">Credit Card</label>
          </div>
        
         <div class="custom-control custom-radio">
            <input id="stripe" name="payment-method" value="wallet" type="radio" class="custom-control-input" required>
            <label class="custom-control-label" for="stripe">wallet amount</label>
          </div>
       
      
      
        </div>
         
          
       



        <hr class="mb-4">
      
      {{#if orderAddress}}
      <button class="btn-grad" type="submit">Continue to checkout</button>
      {{else}}
     <a class="btn-grad" onclick="addAddress()">Continue to checkout</a>
      {{/if}}
      </form>
   
   

{{!------------------------------------------- multipleAddressModal ---------------------------------------------------------}}





<!-- Modal -->
<div class="modal fade" id="multipleAddress" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header" >
        {{!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> --}}
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
       
       
       <div class="col-md-12 order-md-1">
      <p class="text-center h1 fw-bold mb-3 mx-1 mx-md-4 mt-4 text-warning">Order<span class="text-dark">Address</span></p>
      <form class="needs-validation" action="/orderaddressadd" method="post" id="order-address-form">
       
       

     
      <div class="mb-3">
          <label for="houseName"> Name</label>
          <div class="input-group">

            <input type="text" class="form-control" id="housename" name="name" placeholder="name"
              required>
            <div class="invalid-feedback" style="width: 100%;">
             
            </div>
          </div>
        </div>
    
          <input type="text" name="userId" id="" value="{{user._id}}" hidden>
          
           <div class="mb-3">
          <label for="houseName">phonenumber</label>
          <div class="input-group">

            <input type="text" class="form-control" id="phonenumber" name="phonenumber" placeholder="phonenumber"
              required>
            <div class="invalid-feedback" style="width: 100%;">
             
            </div>
          </div>
        </div>





        
         <div class="mb-3">
          <label for="houseName">House Name</label>
          <div class="input-group">

            <input type="text" class="form-control" id="housename" name="housename" placeholder="housename"
              required>
            <div class="invalid-feedback" style="width: 100%;">
             
            </div>
          </div>
        </div>

         <div class="mb-3">
          <label for="Street">Street</label>
          <div class="input-group">

            <input type="text" class="form-control" id="street" name="street" placeholder="street"
              required>
            <div class="invalid-feedback" style="width: 100%;">
             
            </div>
          </div>
        </div>

         <div class="mb-3">
          <label for="Street">Town</label>
          <div class="input-group">

            <input type="text" class="form-control" id="town" name="town" placeholder="town"
              required>
            <div class="invalid-feedback" style="width: 100%;">
             
            </div>
          </div>
        </div>

         <div class="mb-3">
          <label for="Street">District</label>
          <div class="input-group">

            <input type="text" class="form-control" id="district" name="district" placeholder="district"
              required>
           
          </div>
        </div>

           <div class="col-md-6 mb-3">
          <label for="pincode">Pincode</label>
          <input type="text" class="form-control" name="pincode" id="pincode" placeholder="" value="" required>
          <div class="invalid-feedback">
            Valid last name is required.
          </div>
        </div>
     
       </div>
       
     
     
      <div class="modal-footer" style="background:linear-gradient(135deg, #65799b 0%,#f9c900 100%);">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
    </form>
   
    </div>
  </div>
</div>









   
   
   
    </div>



  </div>


</div>




<style>
.btn-grad {
		background-image: linear-gradient(to right, #eaed4f 0%, #d5a035  51%, #FFA17F  100%);
		margin: 10px;
	  text-decoration: none;
    margin-top: 5%;
   margin-left:35%;
    padding: 15px 15px;
		text-align: center;
		text-transform: uppercase;
		transition: 0.5s;
		background-size: 200% auto;
		color: white;            
		box-shadow: 0 0 20px #eee;
		border-radius: 10px;
		border-color: #eee;
    display: block;
	  }

hr{
border: 0;
    height: 1px;
    background-image: linear-gradient(to right, #f0f0f0, #c6ef21, #f0f0f0);
   
}

         
         .btn-applycoupon {
            background-image: linear-gradient(to right, #888685 0%, #FFFFFF  51%, #808080  100%);
            margin: 10px;
           margin-left: 37%;
            padding: 10px 10px;
            color: black;
            text-align: center;
            text-transform: uppercase;
            transition: 0.5s;
            background-size: 200% auto;
            color: white;            
            box-shadow: 0 0 20px rgb(248, 237, 237);
            border-radius: 10px;
            display: block;
         border-color: #fff;
          }

          .btn-applycoupon:hover {
            background-position: right center; /* change the direction of the change here */
            color: #fff;
            text-decoration: none;
          }
         
</style>

















<script>

  $('#checkout-form').submit((e) => {
    e.preventDefault()
    $.ajax({
      url: '/checkcart',
      method: "post",
      data: $('#checkout-form').serialize(),
      success: (response) => {
        console.log(response,'response from checkcart')
      
      if(response.COD){

     swal({
          title: "Sucess",
          text: "sucessfully placed order",
          icon: "success",
          button: "ok",
        })
          .then((willSuccess) => {
            if (willSuccess) {
              location.href = "/userorders";
            }
          })

      }else if(response.wallet){
       
       swal({
                    title: 'WALLET BALANCE INSUFFICIANT',
                    text:'please select another method',
                    type: 'error'
           })
      
      }else{
        location.href=response.url
      }
      
        
      }
    })
  })

$('#applyCoupon').submit((e)=>{
  e.preventDefault()
  $.ajax({
    url:'/applyCoupon-offer',
    method:'post',
    data:$('#applyCoupon').serialize(),
    success:(totalamount)=>{
     console.log(totalamount,'objectisss......')
     console.log(totalamount.totalAmount,'totalamount......')
    
     if(totalamount.totalAmount>0){
        
        console.log(totalamount,'successs')
     let totalprice=document.getElementById('totalprice')
     document.getElementById('actualCost').value=totalamount.totalAmount
      totalprice.innerHTML=totalamount.totalAmount
      document.getElementById('discounttext').style.display=''
      document.getElementById('discountrate').style.display=''
      discountrate.innerHTML=totalamount.discount
      totalprice.style.color='red';
     totalprice.style.fontSize = "x-large";
     totalprice.style.fontWeight = "900";
     document.getElementById('couponadded').style.display=''  
     document.getElementById('applycoupon').style.display='none'
     document.getElementById('cancelcoupon').style.display=''
    
     }else{

    console.log(totalamount.totalAmount,'false')
     document.getElementById('errcoupon').style.display=''
    
     setTimeout(() => {
  window.location.reload();
          }, 600);

     
     }

    }
  })
})

$('#order-address-form').submit((e)=>{
 console.log('sdhfhsfhsdfvgsdvf')
  e.preventDefault()
  $.ajax({
    url:'/orderaddressadd',
    method:'post',
    data:$('#order-address-form').serialize(),
    success:(response)=>{
      location.reload();
    }
  })
})

function addAddress(){

  swal("add your address");


}




</script>